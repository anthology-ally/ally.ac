<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Blackboard Ally, generate an alternative format">
        <meta name="author" content="Blackboard Inc.">
        <link rel="icon" href="/favicon.ico">

        <title>Blackboard Ally - Generate an alternative format</title>

        <link href="//fonts.googleapis.com/css?family=Roboto:400,300,500" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/style.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/leaderboard.css" rel="stylesheet" type="text/css">

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-NXVW3QS');</script>
        <!-- End Google Tag Manager -->
    </head>

    <body>
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NXVW3QS"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->


        <section id="top" class="clearfix">
            <!-- NAVIGATION -->
            <nav class="header">
                <div class="col-xs-1 col-sm-4">
                    <h1>
                        <a href="/index.html"><img src="/assets/img/ally-a.svg" alt="" />
                            <span class="hidden-xs hidden-sm" data-i18n="NAVIGATION_LINK_INDEX"></span></a>
                    </h1>
                </div>
                <div class="col-xs-11 col-sm-8">
                    <ul>
                        <li><a href="/courses.html" data-i18n="NAVIGATION_LINK_COURSES"></a></li>
                        <li><a href="/websites.html" data-i18n="NAVIGATION_LINK_WEBSITES"></a></li>
                        <li class="hidden-xs hidden-sm"><a href="https://usergroup.ally.ac" target="_blank" data-i18n="NAVIGATION_LINK_COMMUNITY"></a></li>
                        <li class="hidden-xs hidden-sm"><a href="https://usergroup.ally.ac/s/tour/" target="_blank" data-i18n="NAVIGATION_LINK_ALLY_TOUR"></a></li>
                        <li><a class="hidden-xs hidden-sm" id="btn-primary" href="/demo.html" data-i18n="NAVIGATION_LINK_REQUEST_DEMO"></a></li>
                    </ul>
                </div>
            </nav>
        </section>
        <main>
            <div class="container">
                <div class="row vertical-align">
                    <div id="leaderboard" class="table">
                        <div class="chart-container">
                            <div class="chart-holder">
                                <div id="chart-container" style="width:100%; height:400px;"></div>
                            </div>
                        </div>
                        <div class="table_row header">
                            <div class="table_column table_header"></div>
                            <div class="table_column table_header"></div>
                            <div class="table_column table_header">Fixes</div>
                            <div class="table_column table_header">Students</div>
                            <div class="table_column table_header">Fixes per student</div>
                        </div>
                        <div class="table_body">

                        </div>
                        <div class="table_footer">
                            <div class="table_column position"></div>
                            <div class="table_column">
                                <a href="#" class="table_show_full">Show full list</a>
                            </div>
                            <div class="table_column"></div>
                            <div class="table_column"></div>
                            <div class="table_column table_header"><span>Out of total participants:</span><span class="units"></span></div>
                            <div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="container-fluid">
            <div class="row">
                <div class="col-xs-12">
                    <ul>
                        <!-- <li><a href="index.html"><img src="/assets/img/ally-a.svg" alt="Blackboard Ally" /></a></li> -->
                        <li><a href="https://usergroup.ally.ac/s/announcements/" target="_blank" title="Blackboard Ally Announcements" data-i18n="NAVIGATION_LINK_ANNOUNCEMENTS"></a></li>
                        <li><a href="https://usergroup.ally.ac/s/releases/" target="_blank" title="Blackboard Ally Release notes" data-i18n="NAVIGATION_LINK_RELEASE_NOTES"></a></li>
                        <li><a href="https://usergroup.ally.ac/s/discussion/" target="_blank" title="Blackboard Ally Discussions" data-i18n="NAVIGATION_LINK_DISCUSSIONS"></a></li>
                        <li><a href="https://usergroup.ally.ac/s/case-studies/" target="_blank" title="Blackboard Ally Case studies" data-i18n="NAVIGATION_LINK_CASE_STUDIES"></a></li>
                        <li><a href="https://usergroup.ally.ac/s/resources/" target="_blank" title="Blackboard Ally Resources" data-i18n="NAVIGATION_LINK_RESOURCES"></a></li>
                        <li><a href="https://www.youtube.com/channel/UCWXzwKChiyWOXMTN9qQFSnQ" target="_blank" title="Blackboard Ally on YouTube" data-i18n="NAVIGATION_LINK_YOUTUBE"></a></li>
                    </ul>
                </div>
                <div class="col-xs-12">
                    <div id="footer-copyright-container" data-i18n="COPYRIGHT">
                        <a href="https://help.blackboard.com/Privacy_Statement" target="_blank" data-i18n="PRIVACY_POLICY"></a>
                        <span class="footer-copyright-divider">|</span>
                        <a href="https://help.blackboard.com/Terms_of_Use" target="_blank" data-i18n="TERMS_OF_USE"></a>
                        <span class="footer-copyright-divider">|</span>
                        <span id="footer-year"></span>
                    </div>
                </div>
            </div>
        </footer>

        <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.min.js" integrity="sha256-Xe5TCNN0b3K98e99/oWJr0FOiSTILqWWWEaDCY48V5E=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.parser.min.js" integrity="sha256-wShTIrxeao7Eih6UkkjLqdE2jiH/N0MqaJdiXeGl/7o=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.emitter.bidi.min.js" integrity="sha256-gtc2Tvs5/k9I3Q28OZ/CP7TzCHANC8wUbJZQVE989Do=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.emitter.min.js" integrity="sha256-VNKWSG0j8kQ/+I4J9r0skSppRy11yw7kRmoZK7xmcIM=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.fallbacks.min.js" integrity="sha256-JYNCT/waNdj6h/SOcUqOmluIEjQakFz54nrbkd44Kj0=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.language.min.js" integrity="sha256-GQa4KOpPyr5vY9JrqY9ibG3IXNyNTzTpb/K4fyReaBY=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.i18n/1.0.7/jquery.i18n.messagestore.min.js" integrity="sha256-dxDziD29LGTvKo6LXzZmm8o8W87YCu4BOh+tsrDJd4k=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.loadtemplate/1.5.10/jquery.loadTemplate.min.js"></script>

        <script src="https://code.highcharts.com/highcharts.js"></script>

        <script>
          var data = [];

          function renderItem(fixdata) {
                $(".table_body").append(`
                    <div class="table_row">
                        <div class="table_column position">${fixdata.position}</div>
                        <div class="table_column details table_white table_left_side_radius">
                            <div class="details_child">${fixdata.details.name}</div>
                            <div class="details_child">${fixdata.details.location}</div>
                        </div>
                        <div class="table_column table_white">${fixdata.fixes}</div>
                        <div class="table_column table_white">${fixdata.students}</div>
                        <div class="table_column table_grey table_right_side_radius">${fixdata.fixes_per_student}</div>
                    </div>
                    `)
          }

          function showAll() {
              $(".table_body").html('');
              data.forEach(element => {
                  renderItem(element);
              });
              $(".units").text(data.length);
          }

          function renderTopFive() {
              $(".table_body").html('');
              data.slice(0,5).forEach(element => {
                  renderItem(element);
              });
              $(".units").text(data.length);
          }
          $('.table_show_full').on('click', function(e) {
              showAll();
              e.preventDefault();
              $('.table_show_full').remove();
          });

          function loadData() {
            $.getJSON("https://gaad-dedd2.firebaseio.com/gaad.json", function() {
                console.log( "Fixes count loaded" );
            }).done(function(results) {
                $.getJSON( "fte.json", function() {
                    console.log( "Fte Counts loaded" );
                }).done(function(response) {
                    for (var key in results) {
                        var value = results[key];
                        var regionAndId = key.split('-');
                        var region = regionAndId[0];
                        var id = regionAndId[1];

                        var uniDetails = response[key];
                        var fixesPerStudent = 0;
                        if (uniDetails) {
                            if (value && value > 0) {
                                fixesPerStudent = value / uniDetails.fte;
                            }
                            var details = {
                                "details": {
                                    "name": uniDetails.name,
                                    "location": uniDetails.location
                                },
                                "fixes": value,
                                "students": uniDetails.fte,
                                "fixes_per_student": fixesPerStudent.toFixed(8)
                            };
                            data.push(details);
                        } else {
                            var details = {
                                "details": {
                                    "name": "Unknown",
                                    "location": "Unknown"
                                },
                                "fixes": value,
                                "students": 0,
                                "fixes_per_student": fixesPerStudent.toFixed(8)
                            };
                            data.push(details);
                        }
                    }

                    data.sort(function (left, right) {
                        return left.fixes_per_student - right.fixesPerStudent;
                    });

                    var position = 1;
                    data.forEach(element => {
                        element.position = position++;
                    });

                    renderTopFive();

                    
                  })
                  .fail(function(data) {
                    console.log(data);
                  });
            });
          }

          function loadGraph() {
            $.getJSON("https://gaad-dedd2.firebaseio.com/gaad-total.json", function() {
                console.log("Graph Data loaded")
            }).done(function(response) {
                var labels = [];
                var points = [];
                var last = 0;
                for (var timestamp in response) {
                    var fixes = response[timestamp];
                    labels.push(Number(timestamp));
                    points.push(fixes);
                    last = fixes;
                }

                var myChart = Highcharts.chart('chart-container', {
                    chart: {
                        type: 'line',
                        backgroundColor: 'transparent',
                        color: '#00C7D1'
                    },
                    legend: {
                        enabled: false
                    },
                    title: {
                        text: 'Total fixes around the world',
                        align: 'left',
                        style: { "color": "#FFF", "fontSize": "18px" }
                    },
                    caption: {
                        text: last,
                        y: 60,
                        verticalAlign: "top",
                        useHTML: true
                    },
                    xAxis: {
                        visible: false
                    },
                    yAxis: {
                        visible: false
                    },
                    series: [{
                        name: 'Fixes',
                        data: points
                    }]
                });
               
            });
          }

          loadData();
          loadGraph();
        </script>

        <script>
            (function(i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] ||
                function() {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-74642053-1', 'auto');
            ga('send', 'pageview');
        </script>
        <script type="text/javascript">
            var _dcq = _dcq || [];
            var _dcs = _dcs || {};
            _dcs.account = '9041875';

            (function() {
                var dc = document.createElement('script');
                dc.type = 'text/javascript';
                dc.async = true;
                dc.src = '//tag.getdrip.com/9041875.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(dc, s);
            })();
        </script>
        <script
        data-ally-loader
        data-ally-platform-name="web"
        data-ally-client-id="306"
        data-ally-af-style="none"
        src="https://prod-eu-central-1.ally.ac/integration/api/ally.ui.js">
        </script>

    </body>
</html>
